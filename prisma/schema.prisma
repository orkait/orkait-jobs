generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model applications {
  id              Int       @id @default(autoincrement())
  job_id          Int?
  name            String    @db.VarChar(255)
  email           String    @db.VarChar(255)
  phone           String?   @db.VarChar(50)
  resume_url      String?   @db.VarChar(255)
  cover_letter    String?
  linkedin_url    String?   @db.VarChar(255)
  portfolio_url   String?   @db.VarChar(255)
  status          String?   @default("pending") @db.VarChar(20)
  is_bookmarked   Boolean?  @default(false)
  notes           String?
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  updated_at      DateTime? @default(now()) @db.Timestamptz(6)
  referred_by     String?
  portfolio_links String[]
  jobs            jobs?     @relation(fields: [job_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([job_id], map: "idx_applications_job_id")
  @@index([status], map: "idx_applications_status")
}

model jobs {
  id           Int            @id @default(autoincrement())
  title        String         @db.VarChar(255)
  description  String
  location     String?        @db.VarChar(255)
  type         String?        @db.VarChar(50)
  department   String?        @db.VarChar(100)
  requirements String?
  status       String?        @default("draft") @db.VarChar(20)
  created_at   DateTime?      @default(now()) @db.Timestamptz(6)
  updated_at   DateTime?      @default(now()) @db.Timestamptz(6)
  applications applications[]

  @@index([status], map: "idx_jobs_status")
}

model interviewers {
  id                 Int                  @id @default(autoincrement())
  name               String               @db.VarChar(255)
  email              String               @unique @db.VarChar(255)
  role               String?              @db.VarChar(100)
  calendar_slug      String               @unique @db.VarChar(100)
  created_at         DateTime?            @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?            @default(now()) @db.Timestamptz(6)
  availability_slots availability_slots[]
  booking_links      booking_links[]
  bookings           bookings[]
}

model availability_slots {
  id              Int          @id @default(autoincrement())
  interviewer_id  Int
  date            DateTime     @db.Date
  start_time      DateTime     @db.Time(6)
  end_time        DateTime     @db.Time(6)
  is_recurring    Boolean      @default(false)
  recurrence_rule String?      @db.VarChar(100)
  admin_notes     String?
  created_at      DateTime?    @default(now()) @db.Timestamptz(6)
  slot_duration   Int          @default(30)
  meeting_type    String?      @default("interview") @db.VarChar(50)
  meeting_title   String?      @db.VarChar(255)
  meeting_description String?
  interviewer     interviewers @relation(fields: [interviewer_id], references: [id], onDelete: Cascade)
  bookings        bookings[]

  @@index([interviewer_id, date])
  @@index([meeting_type])
}

model bookings {
  id                Int                @id @default(autoincrement())
  slot_id           Int
  interviewer_id    Int
  candidate_name    String             @db.VarChar(255)
  candidate_email   String             @db.VarChar(255)
  booked_date       DateTime           @db.Date
  booked_start_time DateTime           @db.Time(6)
  booked_end_time   DateTime           @db.Time(6)
  slot_number       Int                @default(1)
  status            String             @default("pending") @db.VarChar(20)
  admin_notes       String?
  created_at        DateTime?          @default(now()) @db.Timestamptz(6)
  interviewer       interviewers       @relation(fields: [interviewer_id], references: [id], onDelete: Cascade)
  slot              availability_slots @relation(fields: [slot_id], references: [id], onDelete: Cascade)

  @@index([interviewer_id, booked_date])
  @@index([candidate_email])
  @@index([status])
}

model booking_links {
  id                  Int          @id @default(autoincrement())
  token               String       @unique @db.VarChar(64)
  interviewer_id      Int
  created_at          DateTime     @default(now()) @db.Timestamptz(6)
  expires_at          DateTime     @db.Timestamptz(6)
  used_at             DateTime?    @db.Timestamptz(6)
  used_by_email       String?      @db.VarChar(255)
  custom_title        String?      @db.VarChar(255)
  allow_multiple_slots Boolean     @default(false)
  interviewer         interviewers @relation(fields: [interviewer_id], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([interviewer_id])
  @@index([expires_at])
}

model system_config {
  id          Int       @id @default(autoincrement())
  key         String    @unique @db.VarChar(100)
  value       Json
  description String?   @db.VarChar(255)
  created_at  DateTime  @default(now()) @db.Timestamptz(6)
  updated_at  DateTime  @updatedAt @db.Timestamptz(6)
  
  @@index([key])
}
